<!-- # client/entry.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Presenz | Attendance</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/icons/check-circle-fill.svg" type="image/svg+xml">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .attendance-card {
            width: 100%;
            max-width: 420px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 15px 40px rgba(0,0,0,0.35);
            color: white;
        }

        .attendance-card input {
            background: rgba(255,255,255,0.85);
        }

        .attendance-card label,
        .attendance-card small {
            color: #f1f5f9;
        }

        .btn-primary {
            background: linear-gradient(90deg, #1e3c72, #2a5298);
            border: none;
            border-radius: 10px;
            font-weight: 500;
        }

        .btn-primary:hover {
            opacity: 0.95;
        }
    </style>
</head>

<body>
<div class="card attendance-card p-4">
    <div class="text-center mb-3">
        <h4 class="fw-semibold">Presenz</h4>
        <small class="text-muted">Session Attendance</small>
    </div>

    <form id="attendance-form">

        <!-- Name: alphabets + spaces only -->
        <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input type="text"
                    name="name"
                    class="form-control"
                    required
                    minlength="2"
                    maxlength="100"
                    pattern="^[A-Za-z. ]+$"
                    title="Name should contain alphabets and spaces only">
        </div>

        <!-- Roll No: alphanumeric with optional '-' separator -->
        <div class="mb-3">
            <label class="form-label">Roll Number</label>
            <input type="text"
                    name="roll"
                    class="form-control"
                    required
                    maxlength="30"
                    pattern="^[A-Za-z0-9]+(-[A-Za-z0-9]+)*$"
                    title="Roll number can contain letters, numbers, and hyphen (-)">
        </div>

        <!-- Session Code: alphanumeric + special chars -->
        <div class="mb-3">
            <label class="form-label">Session Code</label>
            <input type="text"
                    name="session_code"
                    class="form-control"
                    required
                    maxlength="30"
                    pattern="^[A-Za-z0-9!@#$%^&*()_\-+=]+$"
                    title="Session code can contain letters, numbers, and special characters">
        </div>

        <div class="d-grid">
            <button type="submit" class="btn btn-primary">
                Submit Attendance
            </button>
        </div>

    </form>

    <div class="text-center mt-3">
        <small class="text-muted">
            Server-side validation enforced
        </small>
    </div>
</div>

<script>
const form = document.getElementById("attendance-form");
form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // Correctly access inputs by name
    const data = {
        name: form.elements["name"].value,
        roll: form.elements["roll"].value,
        session_code: form.elements["session_code"].value
    };

    try {
        const res = await fetch("/attendance/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        if (!res.ok) {
            const err = await res.json();
            throw new Error(err.detail || "Unknown error");
        }

        const result = await res.json();
        alert(result.message);
        form.reset();
    } catch(err) {
        alert("Submission failed: " + err.message);
    }
});
</script>
</body>
</html>